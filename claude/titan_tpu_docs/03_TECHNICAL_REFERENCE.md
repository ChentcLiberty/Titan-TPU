# 03 - æŠ€æœ¯è§„æ ¼è¯¦è§£

> æœ¬æ–‡æ¡£åŒ…å« Titan-TPU V2 é¡¹ç›®çš„æ‰€æœ‰æŠ€æœ¯ç»†èŠ‚ï¼Œä¾›å¼€å‘å’Œé¢è¯•å‚è€ƒ

---

## ğŸ“‹ ç›®å½•

1. [tiny-tpu-v2 æºç åˆ†æ](#1-tiny-tpu-v2-æºç åˆ†æ)
2. [PE æ¨¡å—è¯¦è§£](#2-pe-æ¨¡å—è¯¦è§£)
3. [Systolic Array è¯¦è§£](#3-systolic-array-è¯¦è§£)
4. [å®šç‚¹æ•°ç³»ç»Ÿ Q8.8](#4-å®šç‚¹æ•°ç³»ç»Ÿ-q88)
5. [Control Unit ä¸ ISA](#5-control-unit-ä¸-isa)
6. [ECC SECDED æŠ€æœ¯è§„æ ¼](#6-ecc-secded-æŠ€æœ¯è§„æ ¼)
7. [Sparse ä¼˜åŒ–æŠ€æœ¯è§„æ ¼](#7-sparse-ä¼˜åŒ–æŠ€æœ¯è§„æ ¼)
8. [AXI æ¥å£æŠ€æœ¯è§„æ ¼](#8-axi-æ¥å£æŠ€æœ¯è§„æ ¼)
9. [æ—¶åºçº¦æŸä¸ PPA ç›®æ ‡](#9-æ—¶åºçº¦æŸä¸-ppa-ç›®æ ‡)

---

## 1. tiny-tpu-v2 æºç åˆ†æ

### 1.1 æ–‡ä»¶ä¾èµ–å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        tiny-tpu-v2 æ–‡ä»¶ä¾èµ–å…³ç³»                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              tpu.sv (é¡¶å±‚)
                                   â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                       â”‚                       â”‚
           â–¼                       â–¼                       â–¼
    unified_buffer.sv       systolic.sv            control_unit.sv
           â”‚                       â”‚                       â”‚
           â”‚                       â–¼                       â”‚
           â”‚                    pe.sv                      â”‚
           â”‚                       â”‚                       â”‚
           â”‚                       â–¼                       â”‚
           â”‚                fixedpoint.sv â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                       â”‚
           â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚           â”‚                       â”‚
           â–¼           â–¼                       â–¼
        vpu.sv    bias_*.sv              leaky_relu_*.sv
           â”‚           â”‚                       â”‚
           â”‚           â–¼                       â–¼
           â”‚    loss_*.sv            gradient_descent.sv
           â”‚           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è®­ç»ƒæ”¯æŒ
```

### 1.2 å„æ–‡ä»¶åŠŸèƒ½è¯´æ˜

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ | ä¾èµ– | é‡è¦æ€§ |
|------|------|------|------|--------|
| `tpu.sv` | ~200 | TPU é¡¶å±‚é›†æˆ | æ‰€æœ‰æ¨¡å— | â­â­â­â­â­ |
| `pe.sv` | ~100 | å¤„ç†å•å…ƒ (MAC) | fixedpoint | â­â­â­â­â­ |
| `systolic.sv` | ~200 | 2Ã—2 è„‰åŠ¨é˜µåˆ— | pe | â­â­â­â­â­ |
| `fixedpoint.sv` | ~400 | Q8.8 å®šç‚¹åº“ | æ—  | â­â­â­â­ |
| `unified_buffer.sv` | ~100 | ç»Ÿä¸€ç¼“å­˜ | æ—  | â­â­â­â­ |
| `control_unit.sv` | ~300 | 94ä½ISAæ§åˆ¶å™¨ | æ—  | â­â­â­â­ |
| `vpu.sv` | ~150 | å‘é‡å¤„ç†å•å…ƒ | bias, relu, loss | â­â­â­ |
| `bias_*.sv` | ~100 | åç½®åŠ æ³• | fixedpoint | â­â­â­ |
| `leaky_relu_*.sv` | ~100 | æ¿€æ´»å‡½æ•° | fixedpoint | â­â­â­ |
| `loss_*.sv` | ~100 | æŸå¤±è®¡ç®— | fixedpoint | â­â­â­ |
| `gradient_descent.sv` | ~100 | æ¢¯åº¦æ›´æ–° | fixedpoint | â­â­ |

### 1.3 æ•°æ®æµæ¦‚è§ˆ

```
è¾“å…¥æ•°æ®                                                              è¾“å‡ºæ•°æ®
   â”‚                                                                     â–²
   â–¼                                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Unified Buffer                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Weight Memory    â”‚  â”‚  Activation Memory â”‚  â”‚   Output Memory    â”‚     â”‚
â”‚  â”‚   (å­˜å‚¨æƒé‡çŸ©é˜µ)   â”‚  â”‚   (å­˜å‚¨è¾“å…¥æ•°æ®)   â”‚  â”‚   (å­˜å‚¨è®¡ç®—ç»“æœ)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                       â”‚                       â”‚
             â–¼                       â–¼                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     Systolic Array 2Ã—2                          â”‚
        â”‚                                                                 â”‚
        â”‚   weights (ä»ä¸Šæ–¹åŠ è½½)                                          â”‚
        â”‚       â†“       â†“                                                 â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
        â”‚   â”‚ PE[0] â”‚ PE[1] â”‚ â† activations (ä»å·¦ä¾§æµå…¥)                  â”‚
        â”‚   â”‚       â”‚       â”‚                                            â”‚
        â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤                                            â”‚
        â”‚   â”‚ PE[2] â”‚ PE[3] â”‚                                            â”‚
        â”‚   â”‚       â”‚       â”‚                                            â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
        â”‚       â†“       â†“                                                 â”‚
        â”‚     partial sums (å‘ä¸‹ç´¯åŠ )                                     â”‚
        â”‚                                                                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          VPU                                    â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
        â”‚   â”‚  Bias  â”‚ â†’ â”‚ Leaky ReLU â”‚ â†’ â”‚  Loss  â”‚ (è®­ç»ƒæ—¶)          â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â–¼
                                                         æœ€ç»ˆè¾“å‡º
```

---

## 2. PE æ¨¡å—è¯¦è§£

### 2.1 PE æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PE (Processing Element)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   pe_weight_in â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   (16-bit)          â”‚                                                       â”‚
â”‚                     â–¼                                                       â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     pe_switch_in                                â”‚
â”‚                â”‚ Weight  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ‡æ¢ä¿¡å·                      â”‚
â”‚                â”‚ Shadow  â”‚                                                  â”‚
â”‚                â”‚  Reg    â”‚                                                  â”‚
â”‚                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                  â”‚
â”‚                     â”‚                                                       â”‚
â”‚   pe_accept_w_in â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚                     â”‚      â”‚                                                â”‚
â”‚                     â–¼      â–¼                                                â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚                â”‚  Weight Active  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                â”‚     Register    â”‚                                      â”‚   â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚   â”‚
â”‚                         â”‚                                               â”‚   â”‚
â”‚   pe_input_in â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚   â”‚
â”‚   (16-bit)              â”‚           â”‚                                   â”‚   â”‚
â”‚                         â–¼           â–¼                                   â”‚   â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚   â”‚
â”‚                     â”‚                   â”‚                               â”‚   â”‚
â”‚                     â”‚   Multiplier      â”‚                               â”‚   â”‚
â”‚                     â”‚   (16Ã—16â†’32)      â”‚                               â”‚   â”‚
â”‚                     â”‚                   â”‚                               â”‚   â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚   â”‚
â”‚                               â”‚                                         â”‚   â”‚
â”‚   pe_psum_in â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚   â”‚
â”‚   (16-bit)                    â”‚         â”‚                               â”‚   â”‚
â”‚                               â–¼         â–¼                               â”‚   â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚
â”‚                           â”‚                   â”‚                         â”‚   â”‚
â”‚                           â”‚     Adder         â”‚                         â”‚   â”‚
â”‚                           â”‚   (32+16â†’32)      â”‚                         â”‚   â”‚
â”‚                           â”‚                   â”‚                         â”‚   â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚                                     â”‚                                   â”‚   â”‚
â”‚                                     â–¼                                   â”‚   â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚   â”‚
â”‚                              â”‚  Truncate   â”‚                            â”‚   â”‚
â”‚                              â”‚  (32â†’16)    â”‚                            â”‚   â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â”‚   â”‚
â”‚                                     â”‚                                   â”‚   â”‚
â”‚                                     â–¼                                   â”‚   â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚   â”‚
â”‚   pe_psum_out â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Output Reg  â”‚                            â”‚   â”‚
â”‚   (16-bit)                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚   â”‚
â”‚                                                                         â”‚   â”‚
â”‚   pe_weight_out â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   (16-bit)                                                                  â”‚
â”‚                                                                             â”‚
â”‚   pe_input_out â—„â”€â”€â”€â”€ (pe_input_in å»¶è¿Ÿä¸€æ‹)                                 â”‚
â”‚   (16-bit)                                                                  â”‚
â”‚                                                                             â”‚
â”‚   pe_valid_out â—„â”€â”€â”€â”€ (pe_valid_in å»¶è¿Ÿä¸€æ‹)                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 PE æ¥å£å®šä¹‰

```systemverilog
module pe #(
    parameter DATA_WIDTH = 16  // Q8.8 å®šç‚¹æ•°
)(
    // æ—¶é’Ÿä¸å¤ä½
    input  logic                      clk,
    input  logic                      rst,
    
    // ä½¿èƒ½æ§åˆ¶
    input  logic                      pe_enabled,
    
    // æƒé‡æ¥å£ (Weight Stationary)
    input  logic signed [DATA_WIDTH-1:0] pe_weight_in,   // æƒé‡è¾“å…¥
    output logic signed [DATA_WIDTH-1:0] pe_weight_out,  // æƒé‡è¾“å‡º (ä¼ é€’ç»™ä¸‹ä¸€ä¸ªPE)
    input  logic                      pe_accept_w_in,    // æ¥å—æƒé‡ä¿¡å·
    input  logic                      pe_switch_in,      // åˆ‡æ¢æƒé‡ä¿¡å·
    output logic                      pe_switch_out,     // åˆ‡æ¢ä¿¡å·è¾“å‡º
    
    // æ¿€æ´»è¾“å…¥æ¥å£
    input  logic signed [DATA_WIDTH-1:0] pe_input_in,    // æ¿€æ´»è¾“å…¥
    output logic signed [DATA_WIDTH-1:0] pe_input_out,   // æ¿€æ´»è¾“å‡º (ä¼ é€’ç»™å³è¾¹PE)
    input  logic                      pe_valid_in,       // è¾“å…¥æœ‰æ•ˆ
    output logic                      pe_valid_out,      // è¾“å‡ºæœ‰æ•ˆ
    
    // éƒ¨åˆ†å’Œæ¥å£
    input  logic signed [DATA_WIDTH-1:0] pe_psum_in,     // éƒ¨åˆ†å’Œè¾“å…¥ (ä»ä¸Šæ–¹)
    output logic signed [DATA_WIDTH-1:0] pe_psum_out     // éƒ¨åˆ†å’Œè¾“å‡º (å‘ä¸‹)
);
```

### 2.3 PE çŠ¶æ€æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PE æ“ä½œçŠ¶æ€                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚
          rst â”€â”€â”€â”€â–¶ â”‚    IDLE      â”‚
                    â”‚              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ pe_accept_w_in = 1
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚
                    â”‚ LOAD_WEIGHT  â”‚ â—„â”€â”€â”€ æƒé‡åŠ è½½åˆ° shadow register
                    â”‚              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ pe_switch_in = 1
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚
                    â”‚ WEIGHT_ACTIVEâ”‚ â—„â”€â”€â”€ æƒé‡ä» shadow åˆ‡æ¢åˆ° active
                    â”‚              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ pe_valid_in = 1
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚       MAC: psum_out = weight * input + psum_in
                    â”‚   COMPUTE    â”‚ â—„â”€â”€â”€ æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰§è¡Œä¸€æ¬¡ MAC
                    â”‚              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ pe_valid_in = 0
                           â”‚
                           â–¼
                      (ç­‰å¾…ä¸‹ä¸€æ¬¡æ•°æ®)
```

### 2.4 PE æ—¶åºå›¾

```
          1   2   3   4   5   6   7   8   9   10  11  12
clk     __|â€¾|_|â€¾|_|â€¾|_|â€¾|_|â€¾|_|â€¾|_|â€¾|_|â€¾|_|â€¾|_|â€¾|_|â€¾|_|â€¾|_

rst     â€¾â€¾â€¾|_________________________________________________

accept_w______|â€¾â€¾â€¾|__________________________________________
                â†‘
                åŠ è½½æƒé‡ W

weight_in______[W1]__________________________________________

switch  ______________|â€¾â€¾â€¾|__________________________________
                        â†‘
                        åˆ‡æ¢æƒé‡

valid_in____________________|â€¾â€¾â€¾â€¾â€¾â€¾â€¾|________________________
                              â†‘   â†‘
                              A1  A2

input_in____________________[A1][A2]_________________________

psum_in _____________________[P1][P2]_________________________

psum_out_________________________[R1][R2]_____________________
                                  â†‘   â†‘
                                  W*A1+P1  W*A2+P2

valid_out__________________________|â€¾â€¾â€¾â€¾â€¾â€¾â€¾|__________________
```

### 2.5 PE æ ¸å¿ƒè®¡ç®—

```
MAC è¿ç®—:
    psum_out = weight_active * input_in + psum_in

å®šç‚¹æ•°ä¹˜æ³• (Q8.8 Ã— Q8.8):
    - è¾“å…¥: 16-bit Ã— 16-bit
    - ä¸­é—´ç»“æœ: 32-bit (Q16.16)
    - æˆªæ–­: å–ä¸­é—´ 16-bit (Q8.8)
    
    product_32bit = weight[15:0] * input[15:0]  // 32-bit
    product_16bit = product_32bit[23:8]          // æˆªæ–­ï¼Œä¿æŒ Q8.8
    
å®šç‚¹æ•°åŠ æ³•:
    psum_out = product_16bit + psum_in  // é¥±å’Œå¤„ç†
```

---

## 3. Systolic Array è¯¦è§£

### 3.1 2Ã—2 Systolic Array æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        2Ã—2 Weight Stationary Systolic Array                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Weight Loading (ä»ä¸Šæ–¹åŠ è½½æƒé‡)
         â”‚           â”‚
         W0          W1
         â”‚           â”‚
         â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                     â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
    â”‚    â”‚               â”‚         â”‚               â”‚                     â”‚
A0 â”€â”€â”€â”€â”€â–¶â”‚    PE[0,0]   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    PE[0,1]   â”‚â”€â”€â”€â”€â”€â–¶ (è¾“å‡ºå‘å³)     â”‚
    â”‚    â”‚               â”‚  A0'    â”‚               â”‚                     â”‚
    â”‚    â”‚  W0 å›ºå®š      â”‚         â”‚  W1 å›ºå®š      â”‚                     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
    â”‚            â”‚ P[0,0]                  â”‚ P[0,1]                       â”‚
    â”‚            â–¼                         â–¼                             â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
    â”‚    â”‚               â”‚         â”‚               â”‚                     â”‚
A1 â”€â”€â”€â”€â”€â–¶â”‚    PE[1,0]   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    PE[1,1]   â”‚â”€â”€â”€â”€â”€â–¶ (è¾“å‡ºå‘å³)     â”‚
    â”‚    â”‚               â”‚  A1'    â”‚               â”‚                     â”‚
    â”‚    â”‚  W2 å›ºå®š      â”‚         â”‚  W3 å›ºå®š      â”‚                     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
    â”‚            â”‚ P[1,0]                  â”‚ P[1,1]                       â”‚
    â”‚            â–¼                         â–¼                             â”‚
    â”‚         Output[0]                 Output[1]                        â”‚
    â”‚                                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®æµè¯´æ˜:
- æƒé‡ (W): ä»ä¸Šæ–¹åŠ è½½ï¼Œå›ºå®šåœ¨ PE ä¸­ (Weight Stationary)
- æ¿€æ´» (A): ä»å·¦ä¾§æµå…¥ï¼Œå‘å³ä¼ é€’
- éƒ¨åˆ†å’Œ (P): ä»ä¸Šæ–¹æµå…¥ï¼Œå‘ä¸‹ç´¯åŠ 
- è¾“å‡º: ä»åº•éƒ¨è¾“å‡ºæœ€ç»ˆç»“æœ
```

### 3.2 çŸ©é˜µä¹˜æ³•æ˜ å°„

```
è®¡ç®— C = A Ã— Bï¼Œå…¶ä¸­:
    A: 2Ã—2 çŸ©é˜µ (æ¿€æ´»)
    B: 2Ã—2 çŸ©é˜µ (æƒé‡)
    C: 2Ã—2 çŸ©é˜µ (è¾“å‡º)

æƒé‡çŸ©é˜µ B é¢„åŠ è½½åˆ° PE:
    PE[0,0] â† B[0,0]    PE[0,1] â† B[0,1]
    PE[1,0] â† B[1,0]    PE[1,1] â† B[1,1]

æ¿€æ´»çŸ©é˜µ A æŒ‰å¯¹è§’çº¿æµå…¥:
    Cycle 0: A[0,0] â†’ PE[0,0]
    Cycle 1: A[0,1] â†’ PE[0,0], A[1,0] â†’ PE[1,0]
    Cycle 2: A[1,1] â†’ PE[0,0] (å·²æµè¿‡), A[1,1] â†’ PE[1,0]
    ...

è¾“å‡ºçŸ©é˜µ C ä»åº•éƒ¨æ”¶é›†:
    C[i,j] = Î£ A[i,k] Ã— B[k,j]
```

### 3.3 Systolic Array æ—¶åº

```
Weight Loading Phase (æƒé‡åŠ è½½):
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ T0 â”‚ T1 â”‚ T2 â”‚ T3 â”‚ T4 â”‚ T5 â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚Loadâ”‚Loadâ”‚Loadâ”‚Loadâ”‚Swchâ”‚    â”‚
â”‚W00 â”‚W01 â”‚W10 â”‚W11 â”‚    â”‚    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

Compute Phase (è®¡ç®—é˜¶æ®µ) - 2Ã—2 çŸ©é˜µä¹˜æ³•:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æ—¶åˆ»â”‚      PE[0,0]           â”‚      PE[0,1]           â”‚      PE[1,0]           â”‚      PE[1,1]           â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ T0 â”‚ W00Ã—A00+0              â”‚ idle                   â”‚ idle                   â”‚ idle                   â”‚
â”‚ T1 â”‚ W00Ã—A01+0              â”‚ W01Ã—A00+P00            â”‚ W10Ã—A00+0              â”‚ idle                   â”‚
â”‚ T2 â”‚ idle                   â”‚ W01Ã—A01+P01            â”‚ W10Ã—A01+P10            â”‚ W11Ã—A00+P00            â”‚
â”‚ T3 â”‚ idle                   â”‚ idle                   â”‚ idle                   â”‚ W11Ã—A01+P01            â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€»å»¶è¿Ÿ = 2N-1 ä¸ªå‘¨æœŸ (å¯¹äº NÃ—N é˜µåˆ—)
```

---

## 4. å®šç‚¹æ•°ç³»ç»Ÿ Q8.8

### 4.1 Q8.8 æ ¼å¼è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            Q8.8 å®šç‚¹æ•°æ ¼å¼                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½å®½: 16 bits (æœ‰ç¬¦å·)

    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ S â”‚   Integer     â”‚         Fraction              â”‚
    â”‚ 1 â”‚   7 bits      â”‚         8 bits                â”‚
    â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     15   14         8   7                            0

S: ç¬¦å·ä½ (0=æ­£, 1=è´Ÿ)
Integer: æ•´æ•°éƒ¨åˆ† (-128 ~ +127)
Fraction: å°æ•°éƒ¨åˆ† (ç²¾åº¦ = 1/256 â‰ˆ 0.00390625)

èŒƒå›´: -128.0 ~ +127.99609375
ç²¾åº¦: 1/256 â‰ˆ 0.00390625
```

### 4.2 å®šç‚¹æ•°è½¬æ¢

```
æµ®ç‚¹æ•° â†’ Q8.8:
    Q8.8_value = round(float_value Ã— 256)
    
    ä¾‹: 1.5 â†’ 1.5 Ã— 256 = 384 = 0x0180
    ä¾‹: -2.25 â†’ -2.25 Ã— 256 = -576 = 0xFDC0

Q8.8 â†’ æµ®ç‚¹æ•°:
    float_value = Q8.8_value / 256.0
    
    ä¾‹: 0x0100 â†’ 256 / 256 = 1.0
    ä¾‹: 0xFF00 â†’ -256 / 256 = -1.0

å¸¸ç”¨å€¼:
    1.0  = 0x0100 (256)
    0.5  = 0x0080 (128)
    0.25 = 0x0040 (64)
    -1.0 = 0xFF00 (-256)
    0.0  = 0x0000 (0)
```

### 4.3 å®šç‚¹æ•°è¿ç®—

```systemverilog
// ä¹˜æ³• (Q8.8 Ã— Q8.8 â†’ Q8.8)
function automatic logic signed [15:0] fp_mul(
    input logic signed [15:0] a,
    input logic signed [15:0] b
);
    logic signed [31:0] product;
    product = a * b;           // 32-bit ä¸­é—´ç»“æœ (Q16.16)
    return product[23:8];      // æˆªæ–­åˆ° Q8.8
endfunction

// åŠ æ³• (Q8.8 + Q8.8 â†’ Q8.8)
function automatic logic signed [15:0] fp_add(
    input logic signed [15:0] a,
    input logic signed [15:0] b
);
    logic signed [16:0] sum;
    sum = a + b;
    // é¥±å’Œå¤„ç†
    if (sum > 32767) return 16'h7FFF;
    else if (sum < -32768) return 16'h8000;
    else return sum[15:0];
endfunction

// MAC (Multiply-Accumulate)
function automatic logic signed [15:0] fp_mac(
    input logic signed [15:0] weight,
    input logic signed [15:0] activation,
    input logic signed [15:0] psum
);
    return fp_add(fp_mul(weight, activation), psum);
endfunction
```

---

## 5. Control Unit ä¸ ISA

### 5.1 94-bit æŒ‡ä»¤æ ¼å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          94-bit æŒ‡ä»¤æ ¼å¼                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[93:90] opcode        - 4 bits  - æ“ä½œç 
[89:74] weight_addr   - 16 bits - æƒé‡åœ°å€
[73:58] act_addr      - 16 bits - æ¿€æ´»åœ°å€
[57:42] out_addr      - 16 bits - è¾“å‡ºåœ°å€
[41:26] rows          - 16 bits - è¡Œæ•°
[25:10] cols          - 16 bits - åˆ—æ•°
[9:0]   misc          - 10 bits - å…¶ä»–å‚æ•°

æ“ä½œç å®šä¹‰:
    4'b0000 - NOP         æ— æ“ä½œ
    4'b0001 - LOAD_W      åŠ è½½æƒé‡åˆ° Systolic Array
    4'b0010 - LOAD_A      åŠ è½½æ¿€æ´»åˆ°ç¼“å­˜
    4'b0011 - MATMUL      æ‰§è¡ŒçŸ©é˜µä¹˜æ³•
    4'b0100 - STORE       å­˜å‚¨ç»“æœ
    4'b0101 - BIAS        æ·»åŠ åç½®
    4'b0110 - RELU        ReLU æ¿€æ´»
    4'b0111 - TRAIN       è®­ç»ƒæ¨¡å¼ (åå‘ä¼ æ’­)
```

### 5.2 Control Unit çŠ¶æ€æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Control Unit FSM                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              reset â”€â”€â”€â”€â–¶â”‚   IDLE   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚
                              â”‚                        â”‚
                              â”‚ new_instruction        â”‚
                              â–¼                        â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
                         â”‚  DECODE  â”‚                  â”‚
                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚
                              â”‚                        â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
           â”‚                  â”‚                  â”‚     â”‚
           â–¼                  â–¼                  â–¼     â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
     â”‚ LOAD_W   â”‚      â”‚ MATMUL   â”‚      â”‚  STORE   â”‚ â”‚
     â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚
     â”‚ åŠ è½½æƒé‡  â”‚      â”‚ çŸ©é˜µä¹˜æ³•  â”‚      â”‚ å­˜å‚¨ç»“æœ  â”‚ â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
          â”‚                 â”‚                  â”‚      â”‚
          â”‚ done            â”‚ done             â”‚ done â”‚
          â”‚                 â”‚                  â”‚      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ECC SECDED æŠ€æœ¯è§„æ ¼

### 6.1 Hamming(39,32) ç¼–ç 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Hamming(39,32) SECDED ç¼–ç                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å…¥: 32-bit æ•°æ® D[31:0]
è¾“å‡º: 39-bit ç¼–ç  C[38:0]

ç¼–ç ç»“æ„:
    C[38]    - å…¨å±€å¥‡å¶ä½ (P_overall)
    C[37:32] - 6ä¸ªæ ¡éªŒä½ (P5, P4, P3, P2, P1, P0)
    C[31:0]  - 32ä½æ•°æ® (D[31:0])

æ ¡éªŒä½è®¡ç®—:
    P0 = D[0]^D[1]^D[3]^D[4]^D[6]^D[8]^D[10]^D[11]^D[13]^D[15]^D[17]^D[19]^D[21]^D[23]^D[25]^D[26]^D[28]^D[30]
    P1 = D[0]^D[2]^D[3]^D[5]^D[6]^D[9]^D[10]^D[12]^D[13]^D[16]^D[17]^D[20]^D[21]^D[24]^D[25]^D[27]^D[28]^D[31]
    P2 = D[1]^D[2]^D[3]^D[7]^D[8]^D[9]^D[10]^D[14]^D[15]^D[16]^D[17]^D[22]^D[23]^D[24]^D[25]^D[29]^D[30]^D[31]
    P3 = D[4]^D[5]^D[6]^D[7]^D[8]^D[9]^D[10]^D[18]^D[19]^D[20]^D[21]^D[22]^D[23]^D[24]^D[25]
    P4 = D[11]^D[12]^D[13]^D[14]^D[15]^D[16]^D[17]^D[18]^D[19]^D[20]^D[21]^D[22]^D[23]^D[24]^D[25]
    P5 = D[26]^D[27]^D[28]^D[29]^D[30]^D[31]
    
    P_overall = P0^P1^P2^P3^P4^P5^D[0]^D[1]^...^D[31]  // æ‰€æœ‰ä½å¼‚æˆ–

æ£€é”™çº é”™:
    syndrome = {P5', P4', P3', P2', P1', P0'}  // æ¥æ”¶åé‡æ–°è®¡ç®—
    
    if (syndrome == 0 && P_overall' == P_overall):
        æ— é”™è¯¯
    elif (syndrome != 0 && P_overall' != P_overall):
        å•æ¯”ç‰¹é”™è¯¯ï¼Œå¯çº æ­£ï¼Œé”™è¯¯ä½ç½® = syndrome
    elif (syndrome == 0 && P_overall' != P_overall):
        P_overall æœ¬èº«å‡ºé”™ï¼Œå¯çº æ­£
    elif (syndrome != 0 && P_overall' == P_overall):
        åŒæ¯”ç‰¹é”™è¯¯ï¼Œæ£€æµ‹åˆ°ä½†ä¸å¯çº æ­£
```

### 6.2 ECC æ¨¡å—æ¥å£

```systemverilog
module ecc_hamming_32b (
    input  logic        clk,
    input  logic        rst,
    
    // ç¼–ç æ¥å£
    input  logic [31:0] data_in,        // åŸå§‹æ•°æ®
    input  logic        encode_en,       // ç¼–ç ä½¿èƒ½
    output logic [38:0] encoded_out,    // ç¼–ç åæ•°æ®
    
    // è§£ç æ¥å£
    input  logic [38:0] encoded_in,     // ç¼–ç æ•°æ®
    input  logic        decode_en,       // è§£ç ä½¿èƒ½
    output logic [31:0] data_out,       // è§£ç æ•°æ®
    output logic        sec_error,       // å•æ¯”ç‰¹é”™è¯¯ (å·²çº æ­£)
    output logic        ded_error        // åŒæ¯”ç‰¹é”™è¯¯ (ä¸å¯çº æ­£)
);
```

### 6.3 ECC æ—¶åº

```
        1    2    3    4    5    6
clk  __|â€¾|__|â€¾|__|â€¾|__|â€¾|__|â€¾|__|â€¾|__

encode_en    |â€¾â€¾â€¾â€¾|
data_in      |D1  |
encoded_out       |E1  |              (1 å‘¨æœŸå»¶è¿Ÿ)

decode_en              |â€¾â€¾â€¾â€¾|
encoded_in             |E1  |
data_out                    |D1  |    (1 å‘¨æœŸå»¶è¿Ÿ)
sec_error                   |0/1 |
ded_error                   |0/1 |
```

---

## 7. Sparse ä¼˜åŒ–æŠ€æœ¯è§„æ ¼

### 7.1 Sparse PE æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Sparse PE æ¶æ„                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                                                         â”‚
   weight_in â”€â”€â”€â”€â”¼â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
                 â”‚  â”‚                                                     â”‚â”‚
                 â”‚  â–¼                                                     â”‚â”‚
                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚â”‚
                 â”‚ â”‚ Zero     â”‚                                           â”‚â”‚
                 â”‚ â”‚ Detect   â”‚â”€â”€â”                                        â”‚â”‚
                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                        â”‚â”‚
                 â”‚               â”‚ is_zero_w                              â”‚â”‚
   input_in â”€â”€â”€â”€â”€â”¼â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”¤
                 â”‚  â”‚            â”‚                                        â”‚â”‚
                 â”‚  â–¼            â”‚                                        â”‚â”‚
                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                        â”‚â”‚
                 â”‚ â”‚ Zero     â”‚  â”‚                                        â”‚â”‚
                 â”‚ â”‚ Detect   â”‚â”€â”€â”¼â”€â”€â”                                     â”‚â”‚
                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ is_zero_i                           â”‚â”‚
                 â”‚               â”‚  â”‚                                     â”‚â”‚
                 â”‚               â–¼  â–¼                                     â”‚â”‚
                 â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚â”‚
                 â”‚            â”‚  OR    â”‚â”€â”€â”€â”€ skip_mac                     â”‚â”‚
                 â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚â”‚
                 â”‚                 â”‚                                      â”‚â”‚
                 â”‚                 â–¼                                      â”‚â”‚
                 â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚â”‚
                 â”‚            â”‚  ICG   â”‚â”€â”€â”€â”€â–¶â”‚    MAC     â”‚              â”‚â”‚
                 â”‚            â”‚ (Clock â”‚     â”‚   Unit     â”‚              â”‚â”‚
                 â”‚            â”‚ Gating)â”‚     â”‚            â”‚              â”‚â”‚
                 â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚â”‚
                 â”‚                                 â”‚                     â”‚â”‚
                 â”‚                                 â–¼                     â”‚â”‚
                 â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚â”‚
   psum_in â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚       MUX                  â”‚             â”‚â”‚
                 â”‚            â”‚  skip_mac ? psum_in : mac  â”‚             â”‚â”‚
                 â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚â”‚
                 â”‚                         â”‚                             â”‚â”‚
                 â”‚                         â–¼                             â”‚â”‚
   psum_out â—„â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚â”‚
                 â”‚                                                       â”‚â”‚
   weight_out â—„â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                 â”‚                                                         â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŠŸè€—ä¼˜åŒ–:
  - å½“ weight æˆ– input ä¸ºé›¶æ—¶ï¼Œè·³è¿‡ MAC è®¡ç®—
  - ä½¿ç”¨ ICG (Integrated Clock Gating) é—¨æ§ MAC æ—¶é’Ÿ
  - é¢„æœŸåŠŸè€—é™ä½: 30-40% (ç¨€ç–åº¦ 50% æ—¶)
```

### 7.2 Sparse PE æ¥å£

```systemverilog
module pe_sparse #(
    parameter DATA_WIDTH = 16
)(
    input  logic                      clk,
    input  logic                      rst,
    input  logic                      pe_enabled,
    
    // æ ‡å‡† PE æ¥å£ (ä¸åŸç‰ˆç›¸åŒ)
    input  logic signed [DATA_WIDTH-1:0] pe_weight_in,
    output logic signed [DATA_WIDTH-1:0] pe_weight_out,
    input  logic signed [DATA_WIDTH-1:0] pe_input_in,
    output logic signed [DATA_WIDTH-1:0] pe_input_out,
    input  logic signed [DATA_WIDTH-1:0] pe_psum_in,
    output logic signed [DATA_WIDTH-1:0] pe_psum_out,
    input  logic                      pe_valid_in,
    output logic                      pe_valid_out,
    
    // Sparse æ‰©å±•æ¥å£
    output logic                      mac_skipped,     // MAC è¢«è·³è¿‡
    output logic                      clk_gated        // æ—¶é’Ÿè¢«é—¨æ§
);
```

### 7.3 Clock Gating å®ç°

```systemverilog
// ICG (Integrated Clock Gating) å•å…ƒ
module clock_gate (
    input  logic clk,
    input  logic enable,
    input  logic test_enable,  // æµ‹è¯•æ¨¡å¼æ—è·¯
    output logic gated_clk
);
    logic enable_latch;
    
    // è´Ÿè¾¹æ²¿é”å­˜ä½¿èƒ½ä¿¡å· (é¿å…æ¯›åˆº)
    always_latch begin
        if (~clk)
            enable_latch <= enable | test_enable;
    end
    
    // é—¨æ§æ—¶é’Ÿ
    assign gated_clk = clk & enable_latch;
endmodule
```

---

## 8. AXI æ¥å£æŠ€æœ¯è§„æ ¼

### 8.1 AXI4-Lite ä¿¡å·

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AXI4-Lite ä¿¡å·åˆ—è¡¨                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å†™åœ°å€é€šé“ (AW):
    AWADDR  [31:0]  - å†™åœ°å€
    AWPROT  [2:0]   - ä¿æŠ¤ç±»å‹
    AWVALID         - åœ°å€æœ‰æ•ˆ
    AWREADY         - ä»è®¾å¤‡å°±ç»ª

å†™æ•°æ®é€šé“ (W):
    WDATA   [31:0]  - å†™æ•°æ®
    WSTRB   [3:0]   - å­—èŠ‚ä½¿èƒ½
    WVALID          - æ•°æ®æœ‰æ•ˆ
    WREADY          - ä»è®¾å¤‡å°±ç»ª

å†™å“åº”é€šé“ (B):
    BRESP   [1:0]   - å“åº” (00=OKAY, 10=SLVERR)
    BVALID          - å“åº”æœ‰æ•ˆ
    BREADY          - ä¸»è®¾å¤‡å°±ç»ª

è¯»åœ°å€é€šé“ (AR):
    ARADDR  [31:0]  - è¯»åœ°å€
    ARPROT  [2:0]   - ä¿æŠ¤ç±»å‹
    ARVALID         - åœ°å€æœ‰æ•ˆ
    ARREADY         - ä»è®¾å¤‡å°±ç»ª

è¯»æ•°æ®é€šé“ (R):
    RDATA   [31:0]  - è¯»æ•°æ®
    RRESP   [1:0]   - å“åº”
    RVALID          - æ•°æ®æœ‰æ•ˆ
    RREADY          - ä¸»è®¾å¤‡å°±ç»ª
```

### 8.2 TPU å¯„å­˜å™¨æ˜ å°„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       TPU å¯„å­˜å™¨åœ°å€æ˜ å°„                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŸºåœ°å€: 0x4000_0000

åç§»åœ°å€    åç§°              æè¿°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0x000       CTRL              æ§åˆ¶å¯„å­˜å™¨
            [0]  - start      å¯åŠ¨è®¡ç®—
            [1]  - abort      ä¸­æ­¢è®¡ç®—
            [7:4]- mode       å·¥ä½œæ¨¡å¼

0x004       STATUS            çŠ¶æ€å¯„å­˜å™¨
            [0]  - busy       å¿™æ ‡å¿—
            [1]  - done       å®Œæˆæ ‡å¿—
            [2]  - error      é”™è¯¯æ ‡å¿—
            [7:4]- state      å½“å‰çŠ¶æ€

0x008       INTR_EN           ä¸­æ–­ä½¿èƒ½
0x00C       INTR_STATUS       ä¸­æ–­çŠ¶æ€

0x010       WEIGHT_ADDR       æƒé‡åŸºåœ°å€
0x014       ACT_ADDR          æ¿€æ´»åŸºåœ°å€
0x018       OUT_ADDR          è¾“å‡ºåŸºåœ°å€

0x020       DIM_M             çŸ©é˜µ M ç»´åº¦
0x024       DIM_N             çŸ©é˜µ N ç»´åº¦
0x028       DIM_K             çŸ©é˜µ K ç»´åº¦

0x100-0x1FF WEIGHT_BUF        æƒé‡ç¼“å­˜ (ç›´æ¥è®¿é—®)
0x200-0x2FF ACT_BUF           æ¿€æ´»ç¼“å­˜ (ç›´æ¥è®¿é—®)
0x300-0x3FF OUT_BUF           è¾“å‡ºç¼“å­˜ (ç›´æ¥è®¿é—®)
```

### 8.3 AXI Wrapper æ¨¡å—

```systemverilog
module axi_tpu_wrapper #(
    parameter ADDR_WIDTH = 32,
    parameter DATA_WIDTH = 32
)(
    // AXI4-Lite Slave æ¥å£
    input  logic                      aclk,
    input  logic                      aresetn,
    
    // å†™åœ°å€é€šé“
    input  logic [ADDR_WIDTH-1:0]     s_axi_awaddr,
    input  logic [2:0]                s_axi_awprot,
    input  logic                      s_axi_awvalid,
    output logic                      s_axi_awready,
    
    // å†™æ•°æ®é€šé“
    input  logic [DATA_WIDTH-1:0]     s_axi_wdata,
    input  logic [DATA_WIDTH/8-1:0]   s_axi_wstrb,
    input  logic                      s_axi_wvalid,
    output logic                      s_axi_wready,
    
    // å†™å“åº”é€šé“
    output logic [1:0]                s_axi_bresp,
    output logic                      s_axi_bvalid,
    input  logic                      s_axi_bready,
    
    // è¯»åœ°å€é€šé“
    input  logic [ADDR_WIDTH-1:0]     s_axi_araddr,
    input  logic [2:0]                s_axi_arprot,
    input  logic                      s_axi_arvalid,
    output logic                      s_axi_arready,
    
    // è¯»æ•°æ®é€šé“
    output logic [DATA_WIDTH-1:0]     s_axi_rdata,
    output logic [1:0]                s_axi_rresp,
    output logic                      s_axi_rvalid,
    input  logic                      s_axi_rready,
    
    // TPU æ ¸å¿ƒæ¥å£
    output logic                      tpu_start,
    input  logic                      tpu_done,
    input  logic                      tpu_busy,
    // ... å…¶ä»–ä¿¡å·
);
```

---

## 9. æ—¶åºçº¦æŸä¸ PPA ç›®æ ‡

### 9.1 æ—¶åºç›®æ ‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ—¶åºçº¦æŸ                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç›®æ ‡é¢‘ç‡: 200 MHz (å‘¨æœŸ = 5 ns)

æ—¶é’Ÿå®šä¹‰:
    create_clock -name clk -period 5.0 [get_ports clk]

è¾“å…¥å»¶è¿Ÿ:
    set_input_delay -clock clk 1.0 [all_inputs]

è¾“å‡ºå»¶è¿Ÿ:
    set_output_delay -clock clk 1.0 [all_outputs]

å…³é”®è·¯å¾„:
    1. MAC è·¯å¾„: multiplier â†’ adder â†’ register
    2. æ§åˆ¶è·¯å¾„: FSM â†’ decoder â†’ buffer_ctrl
    3. æ•°æ®è·¯å¾„: buffer â†’ PE â†’ buffer
```

### 9.2 PPA ç›®æ ‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PPA ç›®æ ‡                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Performance (æ€§èƒ½):
    - å³°å€¼ç®—åŠ›: 2Ã—2Ã—2Ã—200MHz = 1.6 GOPS (INT8)
    - æ‰©å±•åˆ° 8Ã—8: 8Ã—8Ã—2Ã—200MHz = 25.6 GOPS (INT8)

Power (åŠŸè€—):
    - ç›®æ ‡: < 100 mW (8Ã—8 é˜µåˆ—)
    - Sparse ä¼˜åŒ–å: < 60 mW (ç¨€ç–åº¦ 50%)

Area (é¢ç§¯):
    - PE: ~500 é—¨
    - 8Ã—8 é˜µåˆ—: ~50,000 é—¨
    - å®Œæ•´ TPU: ~100,000 é—¨

æ•ˆç‡:
    - GOPS/W: > 250
    - GOPS/mmÂ²: > 100 (28nm)
```

### 9.3 éªŒè¯è¦†ç›–ç‡ç›®æ ‡

```
åŠŸèƒ½è¦†ç›–ç‡:
    - çŠ¶æ€æœºè¦†ç›–: 100%
    - åˆ†æ”¯è¦†ç›–: > 95%
    - æ¡ä»¶è¦†ç›–: > 90%

ä»£ç è¦†ç›–ç‡:
    - è¡Œè¦†ç›–: > 95%
    - æ¡ä»¶è¦†ç›–: > 90%
    - FSM è¦†ç›–: 100%

æ–­è¨€è¦†ç›–ç‡:
    - æ‰€æœ‰æ–­è¨€è§¦å‘: 100%
```

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0 | æ›´æ–°æ—¶é—´: 2025-01-16*
