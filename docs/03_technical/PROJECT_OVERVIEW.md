# 02 - Titan-TPU V2 项目总览

---

## 📋 目录

1. [项目定位](#1-项目定位)
2. [核心资源库](#2-核心资源库)
3. [AXI 升级选项](#3-axi-升级选项)
4. [深入学习资源](#4-深入学习资源)
5. [架构设计](#5-架构设计)
6. [文件结构](#6-文件结构)
7. [技术亮点](#7-技术亮点)

---

## 1. 项目定位

### 1.1 项目分层

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Titan-TPU 项目生态                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  第 1 层: 入门实战                                                       │   │
│   │                                                                         │   │
│   │    tiny-tpu-v2 (1k stars, SystemVerilog)                               │   │
│   │         │                                                               │   │
│   │         │  魔改内容:                                                    │   │
│   │         ├── + ECC SECDED (海思/海光需求)                                │   │
│   │         ├── + Sparse 优化 (NV/AMD需求)                                  │   │
│   │         └── + AXI 总线 (SoC集成)                                        │   │
│   │         │                                                               │   │
│   │         ▼                                                               │   │
│   │    ══════════════════                                                   │   │
│   │    ║ 成都实习投递 ║                                                     │   │
│   │    ══════════════════                                                   │   │
│   │                                                                         │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                          │
│                                      ▼                                          │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  第 2 层: 接口升级                                                       │   │
│   │                                                                         │   │
│   │    AXI 库选择:                                                          │   │
│   │    ├── TAXI (fpganinja) ─────── SV版，首选                              │   │
│   │    ├── pulp-axi (ETH) ───────── 高性能SoC                               │   │
│   │    └── wb2axip (ZipCPU) ─────── 形式化验证                              │   │
│   │                                                                         │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                          │
│                                      ▼                                          │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  第 3 层: 深入研究                                                       │   │
│   │                                                                         │   │
│   │    学术:     Gemmini (Berkeley) ────── Chipyard生态，发论文             │   │
│   │    工业:     NVDLA (NVIDIA) ─────────── 工业级参考                      │   │
│   │    实战:     Ztachip ────────────────── FPGA轻量级                      │   │
│   │                                                                         │   │
│   │         ▼                                                               │   │
│   │    ══════════════════                                                   │   │
│   │    ║ 上海秋招投递 ║                                                     │   │
│   │    ══════════════════                                                   │   │
│   │                                                                         │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                          │
│                                      ▼                                          │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  第 4 层: 编译器全栈                                                     │   │
│   │                                                                         │   │
│   │    TVM-VTA: PyTorch → TVM编译器 → FPGA硬件                              │   │
│   │                                                                         │   │
│   │    目标: 打通 框架→编译→硬件 全流程                                      │   │
│   │                                                                         │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 为什么这样分层？

| 层级 | 目标 | 时间投入 | 产出 |
|------|------|----------|------|
| 第1层 | 快速出活 | 4-6周 | 可演示项目、实习 |
| 第2层 | 工业级质量 | 2-4周 | 工业级接口 |
| 第3层 | 深度理解 | 4-8周 | 论文素材、秋招 |
| 第4层 | 全栈能力 | 4-8周 | 系统架构师方向 |

---

## 2. 核心资源库

### 2.1 tiny-tpu-v2 ⭐⭐⭐⭐⭐

```yaml
项目名称: tiny-tpu-v2
GitHub: https://github.com/tiny-tpu-v2/tiny-tpu
文档网站: https://tinytpu.com
Stars: 1000+
语言: SystemVerilog (46%) + Python (45%)
状态: ✅ 已下载
本地路径: /home/jjt/Titan_TPU_V2/_vendor/tiny-tpu-v2
```

#### 核心文件清单

| 文件 | 功能 | 重要性 | 行数 |
|------|------|--------|------|
| `pe.sv` | Processing Element (MAC单元) | ⭐⭐⭐⭐⭐ | ~100 |
| `systolic.sv` | 2×2 脉动阵列 | ⭐⭐⭐⭐⭐ | ~200 |
| `vpu.sv` | 向量处理单元顶层 | ⭐⭐⭐⭐ | ~150 |
| `unified_buffer.sv` | 统一缓存 | ⭐⭐⭐⭐ | ~100 |
| `control_unit.sv` | 94位ISA控制器 | ⭐⭐⭐⭐ | ~300 |
| `tpu.sv` | TPU顶层 | ⭐⭐⭐⭐⭐ | ~200 |
| `fixedpoint.sv` | Q8.8定点运算库 | ⭐⭐⭐ | ~400 |
| `bias_*.sv` | 偏置模块 | ⭐⭐⭐ | ~100 |
| `leaky_relu_*.sv` | 激活函数 | ⭐⭐⭐ | ~100 |
| `loss_*.sv` | 损失计算 | ⭐⭐⭐ | ~100 |
| `gradient_descent.sv` | 梯度下降 | ⭐⭐⭐ | ~100 |

#### 为什么选择它？

1. **代码量适中**: ~2000行，一个月能读完
2. **SystemVerilog**: 面试标配语言
3. **文档极好**: 有专门网站 tinytpu.com
4. **功能完整**: 前向+反向传播都有
5. **94位ISA**: 展示系统设计能力
6. **活跃维护**: 持续更新中

### 2.2 verilog-axi

```yaml
项目名称: verilog-axi
GitHub: https://github.com/alexforencich/verilog-axi
作者: Alex Forencich
语言: Verilog
状态: ✅ 已下载
本地路径: /home/jjt/Titan_TPU_V2/_vendor/verilog-axi
用途: 基础AXI接口，后续升级为TAXI
```

---

## 3. AXI 升级选项

### 3.1 TAXI ⭐⭐⭐⭐⭐ (首选)

```yaml
项目名称: TAXI
GitHub: https://github.com/fpganinja/taxi
作者: Alex Forencich (同 verilog-axi)
语言: SystemVerilog
特点: verilog-axi 的 SV 继任者
状态: 📋 待下载
```

#### 为什么首选？
- ✅ 同一作者，API 兼容
- ✅ 完全 SystemVerilog
- ✅ 可直接替换 verilog-axi
- ✅ 代码风格现代

#### 关键模块
```
taxi/
├── axi_adapter.sv
├── axi_crossbar.sv
├── axi_interconnect.sv
├── axi_ram.sv
└── axi_register.sv
```

### 3.2 pulp-axi ⭐⭐⭐⭐

```yaml
项目名称: pulp-axi
GitHub: https://github.com/pulp-platform/axi
来源: ETH Zurich PULP 团队
语言: SystemVerilog
特点: 现代高性能 SoC 首选
状态: 📋 待下载
```

#### 适用场景
- 需要高性能 AXI 交叉开关
- 复杂 SoC 集成
- 面试 ARM/高通等公司

### 3.3 wb2axip ⭐⭐⭐

```yaml
项目名称: wb2axip
GitHub: https://github.com/ZipCPU/wb2axip
作者: ZipCPU (业界知名)
语言: Verilog
特点: 形式化验证，极度健壮
状态: 📋 待下载
```

#### 适用场景
- 强调设计可靠性
- 需要讲形式化验证
- Wishbone ↔ AXI 桥接

---

## 4. 深入学习资源

### 4.1 Gemmini ⭐⭐⭐⭐⭐ (学术最强)

```yaml
项目名称: Gemmini
GitHub: https://github.com/ucb-bar/gemmini
来源: UC Berkeley
生态: Chipyard / RISC-V
语言: Chisel → Verilog
```

#### 核心价值
- 🏆 体系结构研究标杆
- 🏆 软硬协同设计 (RoCC 接口)
- 🏆 可发顶会论文 (ISCA/MICRO/HPCA)
- 🏆 学术界认可度最高

#### 学习路径
```
Week 1: 阅读 Gemmini 论文
Week 2: 搭建 Chipyard 环境
Week 3: 跑通 Gemmini 仿真
Week 4-5: 修改参数生成变体
Week 6: 对比分析 vs Titan-TPU
```

#### 关键论文
- "Gemmini: An Agile Systolic Array Generator..." (DAC 2021)

### 4.2 NVDLA ⭐⭐⭐⭐⭐ (工业标杆)

```yaml
项目名称: NVDLA
GitHub: https://github.com/nvdla/hw
网站: https://nvdla.org
来源: NVIDIA
规模: ~50000 行 Verilog
```

#### 核心价值
- 🏭 工业级 NPU 设计规范
- 🏭 完整 CNN 加速器架构
- 🏭 文档是学习正规设计的最佳参考
- 🏭 面试 NVIDIA/AMD 必看

#### 重点模块
| 模块 | 功能 | 学习价值 |
|------|------|----------|
| CMAC | 卷积核心 | 理解 MAC 阵列 |
| SDP | 后处理 | 激活/池化 |
| PDP | 池化 | Pooling 实现 |
| CDMA | DMA | 数据搬运 |

### 4.3 Ztachip ⭐⭐⭐⭐ (FPGA实战)

```yaml
项目名称: Ztachip
GitHub: https://github.com/ztachip/ztachip
特点: 基于 RISC-V 的轻量级 AI 加速器
平台: Artix-7 等低端 FPGA
应用: Vision AI
```

#### 核心价值
- 💡 可以在便宜 FPGA 上跑通
- 💡 有完整的视觉 Demo
- 💡 适合硬件验证和演示

### 4.4 TVM-VTA ⭐⭐⭐⭐ (编译器全栈)

```yaml
项目名称: TVM-VTA
GitHub: https://github.com/apache/tvm-vta
网站: https://tvm.apache.org
特点: 框架→编译器→硬件 全流程
语言: Chisel + Python
```

#### 核心价值
- 🔗 打通 PyTorch/TensorFlow → 编译器 → 硬件
- 🔗 展示软硬协同能力
- 🔗 适合系统架构师方向

---

## 5. 架构设计

### 5.1 原版 tiny-tpu-v2 架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           tiny-tpu-v2 架构                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Control Unit                                  │   │
│  │                      (94-bit ISA)                                    │   │
│  │  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐                             │   │
│  │  │ IDLE │→│ LOAD │→│ CALC │→│ STORE│→ (循环)                        │   │
│  │  └──────┘  └──────┘  └──────┘  └──────┘                             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                         │
│                                   │ control signals                         │
│         ┌─────────────────────────┼─────────────────────────┐              │
│         │                         │                         │              │
│         ▼                         ▼                         ▼              │
│  ┌─────────────┐          ┌─────────────┐          ┌─────────────┐        │
│  │   Unified   │          │  Systolic   │          │    VPU      │        │
│  │   Buffer    │─────────→│   Array     │─────────→│  (Vector    │        │
│  │             │  weights │   2×2       │  outputs │ Processing) │        │
│  │   Weights   │          │             │          │             │        │
│  │   + Data    │          │  ┌───┬───┐  │          │  bias       │        │
│  │             │          │  │PE │PE │  │          │  relu       │        │
│  └─────────────┘          │  ├───┼───┤  │          │  loss       │        │
│         ▲                 │  │PE │PE │  │          └─────────────┘        │
│         │                 │  └───┴───┘  │                 │               │
│         │ activations     └─────────────┘                 │               │
│         │                                                  │               │
│         └──────────────────────────────────────────────────┘               │
│                            feedback (training)                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 Titan-TPU V2 魔改架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Titan-TPU V2 魔改架构                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         AXI4-Lite Interface                          │   │
│  │                    (TAXI / pulp-axi)                                 │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐   │   │
│  │  │   AW    │  │    W    │  │    B    │  │   AR    │  │    R    │   │   │
│  │  │ Channel │  │ Channel │  │ Channel │  │ Channel │  │ Channel │   │   │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                         │
│                                   ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Control Unit                                  │   │
│  │                  (94-bit ISA + Sparse Control)                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                         │
│         ┌─────────────────────────┼─────────────────────────┐              │
│         │                         │                         │              │
│         ▼                         ▼                         ▼              │
│  ┌─────────────┐          ┌─────────────┐          ┌─────────────┐        │
│  │   Unified   │          │  Systolic   │          │    VPU      │        │
│  │   Buffer    │─────────→│   Array     │─────────→│             │        │
│  │   + ECC     │          │   8×8       │          │             │        │
│  │             │          │  (扩展)     │          │             │        │
│  │ ┌─────────┐ │          │             │          └─────────────┘        │
│  │ │Hamming  │ │          │  ┌───────┐  │                                 │
│  │ │(39,32)  │ │          │  │Sparse │  │  ◄── 零值跳过                   │
│  │ │SECDED   │ │          │  │  PE   │  │  ◄── Clock Gating               │
│  │ └─────────┘ │          │  └───────┘  │                                 │
│  └─────────────┘          └─────────────┘                                 │
│        │                                                                   │
│        └── SEC: 纠正单比特错误                                             │
│        └── DED: 检测双比特错误                                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

魔改特性:
  🔹 ECC SECDED: Hamming(39,32) 在 Unified Buffer
  🔹 Sparse PE: 零值检测 + 跳过 + Clock Gating
  🔹 AXI Interface: 工业级总线接口
  🔹 可扩展阵列: 2×2 → 8×8
```

---

## 6. 文件结构

### 6.1 完整目录树

```
/home/jjt/Titan_TPU_V2/
│
├── _vendor/                              # 第三方库
│   │
│   ├── tiny-tpu-v2/                      # ✅ 核心TPU代码
│   │   ├── src/                          # 17个SV源文件
│   │   │   ├── pe.sv                     # PE模块 ⭐
│   │   │   ├── systolic.sv               # 脉动阵列 ⭐
│   │   │   ├── vpu.sv                    # VPU顶层
│   │   │   ├── unified_buffer.sv         # 缓存
│   │   │   ├── control_unit.sv           # 控制器
│   │   │   ├── tpu.sv                    # TPU顶层 ⭐
│   │   │   ├── fixedpoint.sv             # 定点库
│   │   │   ├── bias_child.sv             # 偏置
│   │   │   ├── bias_parent.sv
│   │   │   ├── leaky_relu_child.sv       # 激活
│   │   │   ├── leaky_relu_parent.sv
│   │   │   ├── leaky_relu_derivative_child.sv
│   │   │   ├── leaky_relu_derivative_parent.sv
│   │   │   ├── loss_child.sv             # 损失
│   │   │   ├── loss_parent.sv
│   │   │   └── gradient_descent.sv       # 梯度
│   │   │
│   │   ├── test/                         # Python测试
│   │   └── jupyter/                      # Jupyter演示
│   │
│   ├── verilog-axi/                      # ✅ AXI库(旧版)
│   │
│   ├── taxi/                             # 📋 待下载
│   │
│   └── pulp-axi/                         # 📋 待下载
│
├── rtl/                                  # 📋 魔改模块
│   ├── ecc/
│   │   ├── ecc_encoder.sv                # ECC编码器
│   │   ├── ecc_decoder.sv                # ECC解码器
│   │   └── ecc_hamming_32b.sv            # 完整模块
│   │
│   ├── sparse/
│   │   ├── pe_sparse.sv                  # Sparse PE
│   │   └── clock_gate.sv                 # ICG单元
│   │
│   └── axi/
│       └── axi_tpu_wrapper.sv            # AXI包装器
│
├── tb/                                   # Testbench
│   ├── tb_pe.sv                          # ✅ 已创建
│   ├── tb_systolic.sv                    # 📋 待创建
│   ├── tb_ecc.sv                         # 📋 待创建
│   └── tb_tpu_top.sv                     # 📋 待创建
│
├── uvm/                                  # 📋 UVM环境
│   ├── env/
│   │   ├── tpu_env.sv
│   │   ├── tpu_agent.sv
│   │   ├── tpu_driver.sv
│   │   └── tpu_monitor.sv
│   │
│   └── tests/
│       └── tpu_base_test.sv
│
├── sim/                                  # 仿真
│   ├── vcs/
│   │   └── Makefile                      # ✅ 已创建
│   ├── logs/
│   └── waveforms/
│
├── syn/                                  # 📋 综合
│   ├── scripts/
│   │   └── syn.tcl
│   └── reports/
│
├── model/                                # 📋 Golden Model
│   ├── golden_model.py
│   └── gen_testcase.py
│
├── doc/                                  # 📋 文档
│   ├── architecture.md
│   └── interview_qa.md
│
├── env_setup.sh                          # ✅ 环境脚本
├── claude_debug.py                       # 📋 Claude API
├── venv/                                 # Python虚拟环境
└── README.md
```

---

## 7. 技术亮点

### 7.1 三大魔改特性

| 特性 | 技术方案 | 面试价值 | 目标公司 |
|------|----------|----------|----------|
| **ECC SECDED** | Hamming(39,32) | ⭐⭐⭐⭐⭐ | 海思、海光、车规 |
| **Sparse 优化** | 零值跳过+ICG | ⭐⭐⭐⭐⭐ | NV、AMD、寒武纪 |
| **AXI 总线** | AXI4-Lite | ⭐⭐⭐⭐ | 所有 SoC 公司 |

### 7.2 量化指标 (预期)

| 指标 | 原版 | 魔改后 | 提升 |
|------|------|--------|------|
| 数据可靠性 | 无 | ASIL-B | ✅ |
| 功耗 (稀疏50%时) | 100% | ~60% | -40% |
| 接口标准 | 简单 | AXI4-Lite | ✅ |
| 阵列大小 | 2×2 | 8×8 | 16x |

### 7.3 简历亮点一句话

> "基于开源 TPU 项目进行深度魔改，添加了 **ECC 容错** (Hamming SECDED, 符合车规 ASIL-B)、
> **稀疏化优化** (零值跳过 + Clock Gating, 功耗降低 40%)、
> **AXI 总线接口** (工业级 SoC 集成)，
> 使用 **VCS 仿真**、**UVM 验证**、**DC 综合**，
> 有完整的 **PPA 数据** 和 **覆盖率报告**。"

---

*文档版本: v2.0 | 更新时间: 2025-01-16*
