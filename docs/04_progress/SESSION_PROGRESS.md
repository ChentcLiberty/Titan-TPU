# Titan-TPU é¡¹ç›®è¿›åº¦æ€»ç»“

> **æœ€åæ›´æ–°**: 2026-01-20
> **å½“å‰é˜¶æ®µ**: Week 1 - Day 1-2 (PEæ¨¡å—ç†è§£ä¸ä¿®å¤)
> **ä¼šè¯çŠ¶æ€**: PEæ¨¡å—Bugå·²ä¿®å¤ï¼Œå‡†å¤‡åˆ›å»ºæµ‹è¯•ç¯å¢ƒ

---

## ğŸ“‹ æœ¬æ¬¡ä¼šè¯å®Œæˆçš„å·¥ä½œ

### 1. é¡¹ç›®åˆå§‹åŒ– âœ…
- **Gitä»“åº“çŠ¶æ€**: å·²åˆå§‹åŒ–ï¼Œæœ‰3ä¸ªæ–°æäº¤
- **ç›®å½•ç»“æ„**: å·²éªŒè¯ï¼Œ_vendor/tiny-tpu å’Œ verilog-axi å·²ä¸‹è½½
- **æ–‡æ¡£ç³»ç»Ÿ**: claude/ ç›®å½•ä¸‹æœ‰å®Œæ•´çš„é¡¹ç›®æ–‡æ¡£

### 2. PEæ¨¡å—Bugä¿®å¤ âœ…

#### é—®é¢˜æè¿°
æ–‡ä»¶ï¼š`_vendor/tiny-tpu/src/pe.sv`
- **Bug**: `weight_reg_active` ä¿¡å·è¢«å¤šä¸ª always å—åŒæ—¶é©±åŠ¨
  - `always_comb` (ç¬¬52-56è¡Œ) é©±åŠ¨
  - `always_ff` (ç¬¬61è¡Œ) é©±åŠ¨
- **é”™è¯¯**: VCS æŠ¥é”™ "Illegal combination of drivers"

#### è§£å†³æ–¹æ¡ˆè®¨è®ºè¿‡ç¨‹
æˆ‘ä»¬è®¨è®ºäº†ä¸‰ç§æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ˜¯å¦é‡‡ç”¨ |
|------|------|------|------|----------|
| **Latchæ–¹æ¡ˆ** | ä¿æŒåŸå§‹ always_comb | é¢ç§¯å°ã€å»¶è¿Ÿä½ | æ—¶åºåˆ†æå›°éš¾ã€ä¸æ¨è | âŒ |
| **MUXæ–¹æ¡ˆ** | æ·»åŠ å¯„å­˜å™¨+ç»„åˆMUX | ä¿æŒåŸå§‹æ—¶åºï¼ˆåŒå‘¨æœŸåˆ‡æ¢ï¼‰ | ç¨å¤æ‚ | âŒ |
| **çº¯æ—¶åºæ–¹æ¡ˆ** | åªç”¨ always_ff | ç®€å•ã€å¯é ã€æ˜“éªŒè¯ | å»¶è¿Ÿ1å‘¨æœŸ | âœ… |

#### æœ€ç»ˆä¿®å¤æ–¹æ¡ˆï¼ˆçº¯æ—¶åºï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š
```systemverilog
// åˆ é™¤äº† always_comb å—
// åœ¨ always_ff ä¸­æ·»åŠ æƒé‡åˆ‡æ¢é€»è¾‘ï¼š

always_ff @(posedge clk or posedge rst) begin
    if (rst || !pe_enabled) begin
        weight_reg_active <= 16'b0;
        weight_reg_inactive <= 16'b0;
        // ...
    end else begin
        // æƒé‡åˆ‡æ¢ï¼špe_switch_iné«˜æ—¶æ›´æ–°
        if (pe_switch_in) begin
            weight_reg_active <= weight_reg_inactive;
        end
        // æ²¡æœ‰elseï¼Œweight_reg_activeä¿æŒåŸå€¼ï¼ˆå¯„å­˜å™¨ç‰¹æ€§ï¼‰

        // æƒé‡åŠ è½½åˆ°åå°å¯„å­˜å™¨
        if (pe_accept_w_in) begin
            weight_reg_inactive <= pe_weight_in;
            pe_weight_out <= pe_weight_in;
        end
        // ...
    end
end
```

**å…³é”®æ”¹åŠ¨**ï¼š
- ç¬¬33è¡Œï¼š`weight_reg_active` å£°æ˜ä¸º logicï¼ˆå¯„å­˜å™¨ï¼‰
- ç¬¬64-66è¡Œï¼šæ·»åŠ æƒé‡åˆ‡æ¢é€»è¾‘
- åˆ é™¤äº†åŸæ¥çš„ always_comb å—ï¼ˆç¬¬52-56è¡Œï¼‰

**æ—¶åºå˜åŒ–**ï¼š
- åŸè®¾è®¡ï¼špe_switch_in=1 æ—¶ï¼ŒåŒå‘¨æœŸåˆ‡æ¢ï¼ˆç»„åˆé€»è¾‘ï¼‰
- æ–°è®¾è®¡ï¼špe_switch_in=1 æ—¶ï¼Œä¸‹ä¸€å‘¨æœŸåˆ‡æ¢ï¼ˆæ—¶åºé€»è¾‘ï¼‰
- å½±å“ï¼šæƒé‡åˆ‡æ¢å»¶è¿Ÿ1å‘¨æœŸï¼Œä½†å¯¹æ•´ä½“æ€§èƒ½å½±å“å¾ˆå°

### 3. Gitæäº¤è®°å½• âœ…

```bash
git log --oneline -3
```

è¾“å‡ºï¼š
```
3dcd76c fix(pe): æ”¹ç”¨çº¯æ—¶åºé€»è¾‘è§£å†³å¤šé©±åŠ¨é—®é¢˜
569b657 docs: æ·»åŠ é¡¹ç›®æ–‡æ¡£ç›®å½•
bf153af wip(pe): è§£å†³weight_reg_activeå¤šé©±åŠ¨é—®é¢˜ï¼Œä½¿ç”¨MUXæ–¹æ¡ˆ
```

**æäº¤è¯¦æƒ…**ï¼š
1. **bf153af** (WIP): ä¸­é—´çŠ¶æ€ï¼Œä½¿ç”¨MUXæ–¹æ¡ˆè§£å†³å¤šé©±åŠ¨
2. **569b657**: æ·»åŠ äº† docs/pe_weight_stationary_analysis.md
3. **3dcd76c**: æœ€ç»ˆæ–¹æ¡ˆï¼Œçº¯æ—¶åºé€»è¾‘

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä»»åŠ¡ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### ç«‹å³ä»»åŠ¡ï¼ˆæœ¬æ¬¡ä¼šè¯æˆ–ä¸‹æ¬¡ä¼šè¯å¼€å§‹ï¼‰

#### 1. åˆ›å»º VCS æµ‹è¯•ç¯å¢ƒ ğŸ”„
**ç›®æ ‡**: éªŒè¯ PE æ¨¡å—ä¿®å¤æ˜¯å¦æ­£ç¡®

**æ­¥éª¤**ï¼š
```bash
# 1. åˆ›å»ºæµ‹è¯•ç›®å½•
mkdir -p sim/vcs
cd sim/vcs

# 2. åˆ›å»º Makefile
# å‚è€ƒï¼šclaude/12_SCRIPTS_COLLECTION.md ä¸­çš„ VCS Makefile æ¨¡æ¿

# 3. åˆ›å»º testbench
# æ–‡ä»¶ï¼štb/tb_pe.sv
# å‚è€ƒï¼š_vendor/tiny-tpu/test/test_pe.py çš„æµ‹è¯•é€»è¾‘

# 4. è¿è¡Œä»¿çœŸ
make pe

# 5. æŸ¥çœ‹æ³¢å½¢
verdi -ssf pe.fsdb &
```

**é¢„æœŸç»“æœ**ï¼š
- VCS ç¼–è¯‘é€šè¿‡ï¼ˆæ— å¤šé©±åŠ¨é”™è¯¯ï¼‰
- ä»¿çœŸè¿è¡ŒæˆåŠŸ
- æ³¢å½¢æ˜¾ç¤º MAC è¿ç®—æ­£ç¡®

**å‚è€ƒæ–‡ä»¶**ï¼š
- åŸå§‹æµ‹è¯•ï¼š`_vendor/tiny-tpu/test/test_pe.py`
- VCS ç¯å¢ƒï¼š`claude/05_CLAUDE_CODE_SETUP.md`
- Makefile æ¨¡æ¿ï¼š`claude/12_SCRIPTS_COLLECTION.md`

#### 2. ç†è§£ PE æ¨¡å—åŸç† ğŸ“š
**ç›®æ ‡**: æ·±å…¥ç†è§£ PE çš„å·¥ä½œæœºåˆ¶ï¼Œå‡†å¤‡é¢è¯•é—®ç­”

**å­¦ä¹ é‡ç‚¹**ï¼š
- [ ] Weight Stationary æ•°æ®æµ
  - æƒé‡å›ºå®šåœ¨ PE ä¸­ï¼Œæ•°æ®æµè¿‡
  - ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿï¼ˆå‡å°‘æƒé‡æ¬è¿ï¼‰
- [ ] Q8.8 å®šç‚¹æ•°æ ¼å¼
  - 8ä½æ•´æ•° + 8ä½å°æ•°
  - èŒƒå›´ï¼š-128.0 ~ 127.996
  - ç²¾åº¦ï¼š1/256 â‰ˆ 0.004
- [ ] MAC è¿ç®—
  - `out = in_data * weight + partial_sum`
  - ä¹˜æ³•å™¨ï¼šfxp_mul
  - åŠ æ³•å™¨ï¼šfxp_add

**è¾“å‡º**ï¼š
- åˆ›å»ºå­¦ä¹ ç¬”è®°ï¼š`docs/pe_learning_notes.md`
- å‡†å¤‡3ä¸ªé¢è¯•é—®é¢˜åŠç­”æ¡ˆ

#### 3. æ¨é€åˆ° GitHub ğŸš€
```bash
# æ£€æŸ¥è¿œç¨‹ä»“åº“
git remote -v

# å¦‚æœæ²¡æœ‰è¿œç¨‹ä»“åº“ï¼Œæ·»åŠ 
git remote add origin <your-github-repo-url>

# æ¨é€
git push -u origin master
```

---

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„ï¼ˆå½“å‰çŠ¶æ€ï¼‰

```
/home/jjt/TitanTPU/
â”œâ”€â”€ _vendor/
â”‚   â”œâ”€â”€ tiny-tpu/              # âœ… å·²ä¸‹è½½
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â””â”€â”€ pe.sv          # âœ… å·²ä¿®å¤
â”‚   â””â”€â”€ verilog-axi/           # âœ… å·²ä¸‹è½½
â”œâ”€â”€ claude/                    # âœ… å®Œæ•´æ–‡æ¡£ç³»ç»Ÿ
â”‚   â”œâ”€â”€ ONE_MONTH_ACTION_PLAN.md
â”‚   â”œâ”€â”€ CLAUDE.md
â”‚   â””â”€â”€ titan_tpu_docs/
â”œâ”€â”€ docs/                      # âœ… æ–°å¢
â”‚   â”œâ”€â”€ pe_weight_stationary_analysis.md
â”‚   â””â”€â”€ SESSION_PROGRESS.md    # æœ¬æ–‡ä»¶
â”œâ”€â”€ Gemini/                    # âœ… å‚è€ƒèµ„æ–™
â”œâ”€â”€ sim/                       # â¬œ å¾…åˆ›å»º
â”‚   â””â”€â”€ vcs/
â”‚       â”œâ”€â”€ Makefile
â”‚       â””â”€â”€ run.tcl
â”œâ”€â”€ tb/                        # â¬œ å¾…åˆ›å»º
â”‚   â””â”€â”€ tb_pe.sv
â””â”€â”€ .git/                      # âœ… å·²åˆå§‹åŒ–
```

---

## ğŸ”§ ç¯å¢ƒä¿¡æ¯

### EDA å·¥å…·è·¯å¾„
```bash
VCS:    /home/jjt/install/synopsys/vcs/vcs/T-2022.06
Verdi:  /home/jjt/install/synopsys/verdi/verdi/T-2022.06
DC:     /home/jjt/install/synopsys/dc/syn/T-2022.03-SP2
```

### æ¿€æ´»ç¯å¢ƒ
```bash
cd /home/jjt/TitanTPU
# å¦‚æœæœ‰ env_setup.shï¼Œæ‰§è¡Œï¼š
# source env_setup.sh
```

---

## ğŸ“ å…³é”®çŸ¥è¯†ç‚¹ï¼ˆå·²å­¦ä¹ ï¼‰

### 1. SystemVerilog å¤šé©±åŠ¨é—®é¢˜
- **é—®é¢˜**: åŒä¸€ä¿¡å·è¢«å¤šä¸ª always å—é©±åŠ¨
- **è§£å†³**: åªèƒ½æœ‰ä¸€ä¸ª always å—é©±åŠ¨ä¸€ä¸ªä¿¡å·
- **æœ€ä½³å®è·µ**:
  - ç»„åˆé€»è¾‘ç”¨ always_comb
  - æ—¶åºé€»è¾‘ç”¨ always_ff
  - ä¸è¦æ··ç”¨

### 2. Latch vs å¯„å­˜å™¨
| ç‰¹æ€§ | Latch | å¯„å­˜å™¨ |
|------|-------|--------|
| è§¦å‘ | ç”µå¹³æ•æ„Ÿ | è¾¹æ²¿è§¦å‘ |
| é¢ç§¯ | å° | å¤§ |
| æ—¶åº | éš¾åˆ†æ | æ˜“åˆ†æ |
| æ¨è | âŒ | âœ… |

### 3. ä¸å®Œæ•´èµ‹å€¼çš„åæœ
```systemverilog
// âŒ ä¼šæ¨æ–­å‡º latch
always_comb begin
    if (condition) begin
        signal = value;
    end
    // æ²¡æœ‰ else
end

// âœ… æ­£ç¡®ï¼šå®Œæ•´èµ‹å€¼
always_comb begin
    if (condition) begin
        signal = value1;
    end else begin
        signal = value2;
    end
end

// âœ… æˆ–è€…ç”¨å¯„å­˜å™¨
always_ff @(posedge clk) begin
    if (condition) begin
        signal <= value;
    end
    // æ²¡æœ‰ else ä¹Ÿå¯ä»¥ï¼Œå¯„å­˜å™¨ä¼šä¿æŒ
end
```

---

## ğŸ“ é¢è¯•å‡†å¤‡ï¼ˆåˆæ­¥ï¼‰

### Q1: ä½ åœ¨è¿™ä¸ªé¡¹ç›®ä¸­é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
**ç­”**: é‡åˆ°äº† SystemVerilog å¤šé©±åŠ¨é—®é¢˜ã€‚PE æ¨¡å—ä¸­çš„ `weight_reg_active` ä¿¡å·è¢« `always_comb` å’Œ `always_ff` åŒæ—¶é©±åŠ¨ï¼Œå¯¼è‡´ VCS ç¼–è¯‘é”™è¯¯ã€‚æˆ‘åˆ†æäº†ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼ˆlatchã€MUXã€çº¯æ—¶åºï¼‰ï¼Œæœ€ç»ˆé€‰æ‹©äº†çº¯æ—¶åºæ–¹æ¡ˆï¼Œå› ä¸ºå®ƒæœ€ç®€å•å¯é ï¼Œè™½ç„¶æƒé‡åˆ‡æ¢å»¶è¿Ÿäº†1å‘¨æœŸï¼Œä½†å¯¹æ•´ä½“æ€§èƒ½å½±å“å¾ˆå°ã€‚

### Q2: ä¸ºä»€ä¹ˆä¸ç”¨ latchï¼Ÿ
**ç­”**: è™½ç„¶ latch é¢ç§¯å°ã€å»¶è¿Ÿä½ï¼Œä½†åœ¨ ASIC è®¾è®¡ä¸­ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºï¼š
1. ç”µå¹³æ•æ„Ÿï¼Œå®¹æ˜“äº§ç”Ÿæ¯›åˆº
2. æ—¶åºåˆ†æå›°éš¾
3. å¯æµ‹è¯•æ€§å·®
4. ä¸ç¬¦åˆåŒæ­¥è®¾è®¡è§„èŒƒ

åœ¨å·¥ä¸šç•Œï¼Œé™¤éæœ‰ç‰¹æ®ŠåŸå› ï¼ˆå¦‚æ—¶é’Ÿé—¨æ§ï¼‰ï¼Œå¦åˆ™åº”è¯¥é¿å… latchã€‚

### Q3: ä½ å¦‚ä½•éªŒè¯ä¿®å¤æ˜¯å¦æ­£ç¡®ï¼Ÿ
**ç­”**: æˆ‘è®¡åˆ’åˆ›å»º VCS æµ‹è¯•ç¯å¢ƒï¼Œç¼–å†™ testbench éªŒè¯ PE æ¨¡å—çš„ MAC è¿ç®—åŠŸèƒ½ã€‚æµ‹è¯•ä¼šè¦†ç›–ï¼š
1. æƒé‡åŠ è½½åˆ°åå°å¯„å­˜å™¨
2. æƒé‡åˆ‡æ¢åˆ°å‰å°å¯„å­˜å™¨
3. MAC è¿ç®—ï¼šout = in_data * weight + partial_sum
4. ä½¿ç”¨ Verdi æŸ¥çœ‹æ³¢å½¢ï¼Œç¡®è®¤æ—¶åºæ­£ç¡®

---

## ğŸš¨ æ³¨æ„äº‹é¡¹

### ç»™ä¸‹ä¸€ä¸ª Claude Code ä¼šè¯çš„æç¤º

1. **é¦–å…ˆé˜…è¯»æœ¬æ–‡ä»¶** (`docs/SESSION_PROGRESS.md`)
2. **æŸ¥çœ‹ Git å†å²**: `git log --oneline`
3. **æ£€æŸ¥å½“å‰åˆ†æ”¯**: `git status`
4. **å‚è€ƒè¡ŒåŠ¨è®¡åˆ’**: `claude/ONE_MONTH_ACTION_PLAN.md`
5. **æŸ¥çœ‹é¡¹ç›®æ€»è§ˆ**: `CLAUDE.md`

### å¦‚æœé‡åˆ°é—®é¢˜

- **PE æ¨¡å—ç›¸å…³**: æŸ¥çœ‹ `_vendor/tiny-tpu/src/pe.sv` ç¬¬64-66è¡Œçš„ä¿®å¤
- **æµ‹è¯•ç›¸å…³**: å‚è€ƒ `_vendor/tiny-tpu/test/test_pe.py`
- **VCS ä½¿ç”¨**: æŸ¥çœ‹ `claude/05_CLAUDE_CODE_SETUP.md`
- **Git æ“ä½œ**: æŸ¥çœ‹ `claude/12_SCRIPTS_COLLECTION.md`

### å¿«é€Ÿå‘½ä»¤

```bash
# æŸ¥çœ‹å½“å‰çŠ¶æ€
cd /home/jjt/TitanTPU
git status
git log --oneline -5

# æŸ¥çœ‹ PE æ¨¡å—
cat _vendor/tiny-tpu/src/pe.sv

# æŸ¥çœ‹æ–‡æ¡£
cat docs/SESSION_PROGRESS.md
cat claude/ONE_MONTH_ACTION_PLAN.md
```

---

## ğŸ“Š è¿›åº¦è¿½è¸ª

### Week 1 è¿›åº¦
```
Day 1-2: PEæ¨¡å—ç†è§£ä¸ä¿®å¤
â”œâ”€ [âœ…] ç¯å¢ƒéªŒè¯
â”œâ”€ [âœ…] PEæ¨¡å—é˜…è¯»
â”œâ”€ [âœ…] Bugåˆ†æä¸ä¿®å¤
â”œâ”€ [âœ…] Gitæäº¤
â”œâ”€ [ğŸ”„] VCSæµ‹è¯•ç¯å¢ƒåˆ›å»º  â† å½“å‰ä½ç½®
â”œâ”€ [â¬œ] PEæ¨¡å—æµ‹è¯•é€šè¿‡
â””â”€ [â¬œ] PEåŸç†å­¦ä¹ æ€»ç»“

Day 3-4: Systolic Array
Day 5-7: VPU + Control Unit
```

### æ€»ä½“è¿›åº¦
```
Phase 1 - æ ¸å¿ƒç†è§£        [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30%
Phase 2 - é­”æ”¹ç‰¹æ€§        [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0%
Phase 3 - ç³»ç»Ÿé›†æˆ        [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0%
Phase 4 - éªŒè¯ç¯å¢ƒ        [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0%
Phase 5 - ç»¼åˆåˆ†æ        [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0%
Phase 6 - é¢è¯•å‡†å¤‡        [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0%
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£é“¾æ¥

- **é¡¹ç›®æ€»è§ˆ**: `docs/01_core/CLAUDE.md`
- **è¡ŒåŠ¨è®¡åˆ’**: `claude/ONE_MONTH_ACTION_PLAN.md`
- **æŠ€æœ¯å‚è€ƒ**: `docs/03_technical/TECHNICAL_REFERENCE.md`
- **è¿›åº¦è¿½è¸ª**: `docs/04_progress/PROGRESS_TRACKER.md`
- **Debugæ—¥å¿—**: `docs/04_progress/DEBUG_LOG.md`

---

*æœ€åæ›´æ–°: 2026-01-20 | ä¼šè¯ID: [å½“å‰ä¼šè¯] | ä¸‹æ¬¡ä¼šè¯è¯·ä»"åˆ›å»ºVCSæµ‹è¯•ç¯å¢ƒ"å¼€å§‹*
