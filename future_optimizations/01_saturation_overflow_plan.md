# å¯é…ç½®æº¢å‡ºé¥±å’ŒåŠŸèƒ½è®¡åˆ’

> **ä¼˜å…ˆçº§**: â­â­â­â­â­ (é¢è¯•é«˜é¢‘è€ƒç‚¹)
> **çŠ¶æ€**: ğŸ“‹ è®¡åˆ’ä¸­ - æ—¥åå®ç°
> **é¢„è®¡å·¥ä½œé‡**: 2-3å¤©

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜

### Q: INT8 é‡åŒ–æ¨ç†ä¸ºä»€ä¹ˆè¦é¥±å’Œï¼Ÿ

**ç­”**: é˜²æ­¢ç¬¦å·ç¿»è½¬å¯¼è‡´ç¾éš¾æ€§é”™è¯¯ã€‚

```
ä¸é¥±å’Œ: 127 + 1 = -128  âŒ ç¬¦å·ç¿»è½¬ï¼Œåˆ†ç±»é”™è¯¯
é¥±å’Œ:   127 + 1 = 127   âœ… ä¿æŒæœ€å¤§å€¼ï¼Œæ­£ç¡®åˆ†ç±»
```

---

## ğŸ” å½“å‰è®¾è®¡çŠ¶æ€

### âœ… å·²æœ‰ï¼šæº¢å‡ºæ ‡å¿—ä½ï¼ˆä½†æœªä½¿ç”¨ï¼‰

**æ–‡ä»¶**: `_vendor/tiny-tpu/src/pe.sv` (ç¬¬ 36-48 è¡Œ)

```systemverilog
fxp_mul mult (
    .overflow()  // âš ï¸ æº¢å‡ºæ ‡å¿—ä½å­˜åœ¨ä½†æ‚¬ç©º
);

fxp_add adder (
    .overflow()  // âš ï¸ æº¢å‡ºæ ‡å¿—ä½å­˜åœ¨ä½†æ‚¬ç©º
);
```

### âŒ ç¼ºå¤±ï¼š
- æº¢å‡ºä¿¡å·æœªè¿æ¥
- æ— æº¢å‡ºæ£€æµ‹é€»è¾‘
- æ— é¥±å’Œå¤„ç†
- æ— æº¢å‡ºç»Ÿè®¡

---

## ğŸ”§ ä¼˜åŒ–æ–¹æ¡ˆï¼ˆæ—¥åå®ç°ï¼‰

### æ–¹æ¡ˆ1: æ·»åŠ æº¢å‡ºæ£€æµ‹

```systemverilog
logic mult_overflow, add_overflow;
logic [31:0] overflow_counter;

fxp_mul mult (
    .overflow(mult_overflow)  // âœ… è¿æ¥æº¢å‡ºä¿¡å·
);

always_ff @(posedge clk) begin
    if (mult_overflow || add_overflow)
        overflow_counter <= overflow_counter + 1;
end
```

### æ–¹æ¡ˆ2: å®ç°é¥±å’Œè¿ç®—ï¼ˆæ¨èï¼‰

```systemverilog
module fxp_add_saturate (
    input  logic signed [15:0] ina, inb,
    output logic signed [15:0] out,
    output logic overflow
);
    logic signed [16:0] sum_extended;

    assign sum_extended = ina + inb;
    assign overflow = (sum_extended > 16'sh7FFF) ||
                      (sum_extended < 16'sh8000);

    always_comb begin
        if (sum_extended > 16'sh7FFF)
            out = 16'sh7FFF;      // æ­£é¥±å’Œ
        else if (sum_extended < 16'sh8000)
            out = 16'sh8000;      // è´Ÿé¥±å’Œ
        else
            out = sum_extended[15:0];
    end
endmodule
```

### æ–¹æ¡ˆ3: å¯é…ç½®æ¨¡å¼ï¼ˆå·¥ä¸šçº§ï¼‰

```systemverilog
module pe #(
    parameter bit ENABLE_SATURATION = 1  // å¯é…ç½®
) (
    output logic overflow_flag,
    output logic [31:0] overflow_count
);
    generate
        if (ENABLE_SATURATION)
            fxp_add_saturate adder (...);
        else
            fxp_add adder (...);
    endgenerate
endmodule
```

---

## ğŸ“Š ç¡¬ä»¶å¼€é”€ä¼°ç®—

| æŒ‡æ ‡ | æ™®é€šè¿ç®— | é¥±å’Œè¿ç®— | å¢åŠ  |
|------|----------|----------|------|
| é¢ç§¯ | 100% | 110% | +10% |
| å»¶è¿Ÿ | 1.0ns | 1.5ns | +0.5ns |
| åŠŸè€— | 100% | 105% | +5% |

**ç»“è®º**: å¼€é”€å¯æ¥å—ï¼Œé¿å…ç¾éš¾æ€§é”™è¯¯

---

## ğŸ“ å®æ–½æ­¥éª¤ï¼ˆæ—¥åï¼‰

1. **æŸ¥çœ‹åº•å±‚æ¨¡å—**: åˆ†æ `fxp_mul.sv` å’Œ `fxp_add.sv`
2. **è¿æ¥æº¢å‡ºä¿¡å·**: ä¿®æ”¹ `pe.sv`ï¼Œæ·»åŠ ç»Ÿè®¡å¯„å­˜å™¨
3. **å®ç°é¥±å’Œé€»è¾‘**: åˆ›å»º `fxp_add_saturate.sv`
4. **éªŒè¯ä¸ç»¼åˆ**: VCS ä»¿çœŸ + DC ç»¼åˆåˆ†æ PPA

---

## ğŸ¤ é¢è¯•é—®ç­”ï¼ˆé‡è¦ï¼ï¼‰

### Q: ä¸ºä»€ä¹ˆ INT8 é‡åŒ–æ¨ç†è¦ç”¨é¥±å’Œè¿ç®—ï¼Ÿ

**A**: ä¸‰ä¸ªåŸå› ï¼š
1. **é˜²æ­¢ç¬¦å·ç¿»è½¬**: 127+1 ä¸èƒ½å˜æˆ -128
2. **ä¿æŒå•è°ƒæ€§**: ç¥ç»ç½‘ç»œæ•°å­¦ç‰¹æ€§è¦æ±‚
3. **å·¥ä¸šæ ‡å‡†**: ARM/Intel/NVIDIA éƒ½è¦æ±‚é¥±å’Œ

### Q: ä½ çš„è®¾è®¡æœ‰æº¢å‡ºæ£€æµ‹å—ï¼Ÿ

**A**: æœ‰çš„ã€‚æˆ‘çš„è®¾è®¡é¢„ç•™äº†æº¢å‡ºæ ‡å¿—ä½ï¼ˆ`fxp_mul` å’Œ `fxp_add` éƒ½æœ‰ `overflow` è¾“å‡ºï¼‰ï¼Œç›®å‰ç”¨äºè°ƒè¯•ã€‚å®é™…éƒ¨ç½²æ—¶å¯æ·»åŠ é¥±å’Œé€»è¾‘ï¼Œç¡¬ä»¶å¼€é”€çº¦ +10% é¢ç§¯å’Œ +0.5ns å»¶è¿Ÿï¼Œä½†èƒ½é¿å…ç¬¦å·ç¿»è½¬å¯¼è‡´çš„ç¾éš¾æ€§é”™è¯¯ã€‚

---

## ğŸ”— å‚è€ƒèµ„æ–™

- ARM NEON: `vqadd_s8()` é¥±å’ŒåŠ æ³•
- Intel AVX-512: `_mm512_adds_epi8()` é¥±å’ŒåŠ æ³•
- Google TPU: æ‰€æœ‰ INT8 è¿ç®—å¿…é¡»é¥±å’Œ

---

*åˆ›å»ºæ—¶é—´: 2026-01-21 | ä½œè€…: Chen Weidong*
