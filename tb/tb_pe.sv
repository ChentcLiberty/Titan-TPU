`timescale 1ns/1ps
`default_nettype none

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PE Module Testbench - Professional Version
// Author: Chen Weidong
// Date: 2026-01-20
//
// Features:
// - FSDB waveform generation for Verdi
// - Self-checking test cases
// - Comprehensive test coverage
// - Clear pass/fail reporting
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

module tb_pe;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ä¿¡å·å£°æ˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    logic clk;
    logic rst;

    // North wires (from above)
    logic signed [15:0] pe_psum_in;
    logic signed [15:0] pe_weight_in;
    logic pe_accept_w_in;

    // West wires (from left)
    logic signed [15:0] pe_input_in;
    logic pe_valid_in;
    logic pe_switch_in;
    logic pe_enabled;

    // South wires (to below)
    logic signed [15:0] pe_psum_out;
    logic signed [15:0] pe_weight_out;

    // East wires (to right)
    logic signed [15:0] pe_input_out;
    logic pe_valid_out;
    logic pe_switch_out;

    // æµ‹è¯•ç»Ÿè®¡
    int test_count = 0;
    int pass_count = 0;
    int fail_count = 0;

    // éšæœºæµ‹è¯•é…ç½®
    int random_test_num = 10;  // éšæœºæµ‹è¯•æ•°é‡

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DUT å®ä¾‹åŒ–
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    pe #(
        .DATA_WIDTH(16)
    ) dut (
        .clk(clk),
        .rst(rst),
        .pe_psum_in(pe_psum_in),
        .pe_weight_in(pe_weight_in),
        .pe_accept_w_in(pe_accept_w_in),
        .pe_input_in(pe_input_in),
        .pe_valid_in(pe_valid_in),
        .pe_switch_in(pe_switch_in),
        .pe_enabled(pe_enabled),
        .pe_psum_out(pe_psum_out),
        .pe_weight_out(pe_weight_out),
        .pe_input_out(pe_input_out),
        .pe_valid_out(pe_valid_out),
        .pe_switch_out(pe_switch_out)
    );

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æ—¶é’Ÿç”Ÿæˆ (10ns å‘¨æœŸ = 100MHz)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    initial begin
        clk = 0;
        forever #5 clk = ~clk;
    end

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FSDB æ³¢å½¢ç”Ÿæˆï¼ˆç”¨äº Verdi è°ƒè¯•ï¼‰
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    initial begin
        $fsdbDumpfile("../waveforms/tb_pe.fsdb");
        $fsdbDumpvars(0, tb_pe);
        $fsdbDumpMDA();  // æ”¯æŒå¤šç»´æ•°ç»„
    end

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æ–­è¨€ï¼ˆAssertionï¼‰- ä¸º UVM éªŒè¯åšå‡†å¤‡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // æ–­è¨€1ï¼šå¤ä½æœŸé—´è¾“å‡ºåº”è¯¥ä¸º0
    property reset_output_zero;
        @(posedge clk) (rst) |-> (pe_psum_out == 0);
    endproperty
    assert property (reset_output_zero)
        else $error("[ASSERTION FAIL] å¤ä½æœŸé—´è¾“å‡ºä¸ä¸º0!");

    // æ–­è¨€2ï¼šæ•°æ®ä¼ æ’­æ£€æŸ¥ - validä¿¡å·ä¼ æ’­åˆ°è¾“å‡º
    // æ³¨æ„ï¼šåœ¨è„‰åŠ¨é˜µåˆ—ä¸­ï¼Œvalidå¯ä»¥è¿ç»­å¤šå‘¨æœŸä¿æŒé«˜ç”µå¹³ï¼Œè¿™æ˜¯æ­£å¸¸çš„
    property valid_propagation;
        @(posedge clk) disable iff (rst)
            pe_valid_in |-> ##1 pe_valid_out;
    endproperty
    assert property (valid_propagation)
        else $warning("[ASSERTION WARN] valid ä¿¡å·æœªæ­£ç¡®ä¼ æ’­åˆ°è¾“å‡º!");

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Q8.8 å®šç‚¹æ•°è½¬æ¢å‡½æ•°
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function automatic logic [15:0] to_fixed(real val);
        return $signed($rtoi(val * 256.0)) & 16'hFFFF;
    endfunction

    function automatic real from_fixed(logic [15:0] val);
        logic signed [15:0] signed_val;
        signed_val = val;
        return $itor(signed_val) / 256.0;
    endfunction

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æµ‹è¯•ä»»åŠ¡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    task automatic reset_dut();
        $display("[%0t] ğŸ”„ å¤ä½ DUT", $time);
        rst = 1;
        pe_enabled = 0;
        pe_valid_in = 0;
        pe_accept_w_in = 0;
        pe_switch_in = 0;
        pe_input_in = 16'h0000;
        pe_weight_in = 16'h0000;
        pe_psum_in = 16'h0000;

        repeat(3) @(posedge clk);
        rst = 0;
        pe_enabled = 1;
        @(posedge clk);
        $display("[%0t] âœ… å¤ä½å®Œæˆ\n", $time);
    endtask

    task automatic load_weight(real weight_val);
        $display("[%0t] ğŸ“¥ åŠ è½½æƒé‡: %.2f", $time, weight_val);
        pe_accept_w_in = 1;
        pe_weight_in = to_fixed(weight_val);
        @(posedge clk);
        pe_accept_w_in = 0;
        $display("[%0t] âœ… æƒé‡å·²åŠ è½½åˆ°åå°å¯„å­˜å™¨", $time);
    endtask

    task automatic switch_weight();
        $display("[%0t] ğŸ”„ åˆ‡æ¢æƒé‡ï¼ˆåå°â†’å‰å°ï¼‰", $time);
        pe_switch_in = 1;
        @(posedge clk);
        pe_switch_in = 0;
        @(posedge clk);  // ç­‰å¾…åˆ‡æ¢å®Œæˆï¼ˆçº¯æ—¶åºé€»è¾‘éœ€è¦1å‘¨æœŸï¼‰
        $display("[%0t] âœ… æƒé‡åˆ‡æ¢å®Œæˆ", $time);
    endtask

    task automatic mac_operation(
        input real input_val,
        input real psum_val,
        input real expected_out,
        input string test_name
    );
        real actual_out;
        real error;

        test_count++;
        $display("[%0t] ğŸ§® MAC è¿ç®— [%s]: %.2f * weight + %.2f",
                 $time, test_name, input_val, psum_val);

        // è®¾ç½®è¾“å…¥æ•°æ®å’Œvalidä¿¡å·
        pe_input_in = to_fixed(input_val);
        pe_psum_in = to_fixed(psum_val);
        pe_valid_in = 1;

        // å·¥ä¸šçº§éªŒè¯æ ‡å‡†åšæ³•ï¼šç­‰å¾…2ä¸ªæ—¶é’Ÿå‘¨æœŸ
        // T1: PEæ•è·è¾“å…¥æ•°æ®
        @(posedge clk);

        // T2: PEè¾“å‡ºè®¡ç®—ç»“æœï¼ˆæµæ°´çº¿å»¶è¿Ÿï¼‰
        @(posedge clk);

        // åœ¨T2æ—¶é’Ÿæ²¿ä¹‹åé‡‡æ ·ï¼Œæ­¤æ—¶è¾“å‡ºå·²ç»ç¨³å®š
        actual_out = from_fixed(pe_psum_out);
        error = $abs(actual_out - expected_out);

        // é‡‡æ ·å®Œæˆåæ‹‰ä½validä¿¡å·
        pe_valid_in = 0;

        $display("[%0t] ğŸ“Š æœŸæœ›: %.4f, å®é™…: %.4f, è¯¯å·®: %.4f (0x%04h)",
                 $time, expected_out, actual_out, error, pe_psum_out);

        if (error < 0.01) begin
            $display("[%0t] âœ… PASS\n", $time);
            pass_count++;
        end else begin
            $display("[%0t] âŒ FAIL - è¯¯å·®è¶…å‡ºå®¹å·®èŒƒå›´!\n", $time);
            fail_count++;
        end
    endtask

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // éšæœºæµ‹è¯•ä»»åŠ¡ï¼ˆä¸º UVM åšå‡†å¤‡ï¼‰
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    task automatic random_mac_test(input int num_tests, input real weight_val);
        real rand_input, rand_psum, expected;
        int seed = $urandom();  // éšæœºç§å­

        $display("[%0t] ğŸ² å¼€å§‹éšæœºæµ‹è¯• (%0d æ¬¡)", $time, num_tests);
        $display("[%0t] ğŸ”‘ éšæœºç§å­: %0d", $time, seed);

        load_weight(weight_val);
        switch_weight();

        for (int i = 0; i < num_tests; i++) begin
            // ç”Ÿæˆéšæœºæ•°ï¼ˆèŒƒå›´ï¼š-10.0 ~ 10.0ï¼‰
            rand_input = ($urandom_range(0, 2000) - 1000) / 100.0;
            rand_psum = ($urandom_range(0, 2000) - 1000) / 100.0;

            // è®¡ç®—æœŸæœ›å€¼
            expected = rand_input * weight_val + rand_psum;

            // æ‰§è¡Œ MAC è¿ç®—
            mac_operation(rand_input, rand_psum, expected,
                         $sformatf("éšæœºæµ‹è¯•-%0d", i+1));
        end

        $display("[%0t] âœ… éšæœºæµ‹è¯•å®Œæˆ\n", $time);
    endtask

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ä¸»æµ‹è¯•æµç¨‹
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    initial begin
        $display("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        $display("ğŸ§ª PE Module Testbench - Professional Version");
        $display("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        $display("æµ‹è¯•å†…å®¹:");
        $display("  1. æƒé‡åŠ è½½åˆ°åå°å¯„å­˜å™¨");
        $display("  2. æƒé‡åˆ‡æ¢åˆ°å‰å°å¯„å­˜å™¨");
        $display("  3. MAC è¿ç®—éªŒè¯ (5ä¸ªå®šå‘æµ‹è¯•)");
        $display("  4. éšæœºæµ‹è¯• (%0d æ¬¡)", random_test_num);
        $display("  5. æ–­è¨€æ£€æŸ¥ï¼ˆAssertionï¼‰");
        $display("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Test 1: åŸºç¡€ MAC è¿ç®—
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        $display("[Test 1] åŸºç¡€ MAC è¿ç®—");
        $display("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        reset_dut();
        load_weight(2.0);
        switch_weight();
        mac_operation(3.0, 1.0, 7.0, "åŸºç¡€è¿ç®—");

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Test 2: é›¶å€¼æµ‹è¯•
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        $display("[Test 2] é›¶å€¼æµ‹è¯•");
        $display("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        reset_dut();
        load_weight(0.0);
        switch_weight();
        mac_operation(5.0, 0.0, 0.0, "é›¶æƒé‡");

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Test 3: è´Ÿæ•°æµ‹è¯•
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        $display("[Test 3] è´Ÿæ•°æµ‹è¯•");
        $display("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        reset_dut();
        load_weight(-1.5);
        switch_weight();
        mac_operation(2.0, 4.0, 1.0, "è´Ÿæƒé‡");

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Test 4: å°æ•°ç²¾åº¦æµ‹è¯•
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        $display("[Test 4] å°æ•°ç²¾åº¦æµ‹è¯•");
        $display("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        reset_dut();
        load_weight(0.5);
        switch_weight();
        mac_operation(1.25, 0.25, 0.875, "å°æ•°ç²¾åº¦");

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Test 5: è¿ç»­ MAC è¿ç®—
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        $display("[Test 6] è¿ç»­ MAC è¿ç®—");
        $display("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        reset_dut();
        load_weight(1.0);
        switch_weight();
        mac_operation(1.0, 0.0, 1.0, "è¿ç»­-1");
        mac_operation(2.0, 0.0, 2.0, "è¿ç»­-2");
        mac_operation(3.0, 0.0, 3.0, "è¿ç»­-3");

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Test 6: éšæœºæµ‹è¯•ï¼ˆæ–°å¢ï¼ï¼‰
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        $display("[Test 6] éšæœºæµ‹è¯•");
        $display("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        reset_dut();
        random_mac_test(random_test_num, 1.5);  // æƒé‡=1.5ï¼Œè¿è¡Œ10æ¬¡éšæœºæµ‹è¯•

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // æµ‹è¯•å®Œæˆ - æ‰“å°ç»Ÿè®¡ä¿¡æ¯
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        repeat(10) @(posedge clk);

        $display("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        $display("ğŸ“Š æµ‹è¯•ç»Ÿè®¡");
        $display("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        $display("  æ€»æµ‹è¯•æ•°: %0d", test_count);
        $display("  é€šè¿‡æ•°:   %0d", pass_count);
        $display("  å¤±è´¥æ•°:   %0d", fail_count);
        $display("  é€šè¿‡ç‡:   %.1f%%", (pass_count * 100.0) / test_count);
        $display("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

        if (fail_count == 0) begin
            $display("âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!");
            $display("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
            $finish(0);  // è¿”å› 0 è¡¨ç¤ºæˆåŠŸ
        end else begin
            $display("âŒ æœ‰ %0d ä¸ªæµ‹è¯•å¤±è´¥!", fail_count);
            $display("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
            $finish(1);  // è¿”å› 1 è¡¨ç¤ºå¤±è´¥
        end
    end

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // è¶…æ—¶ä¿æŠ¤
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    initial begin
        #10000;  // 10us è¶…æ—¶
        $display("\nâŒ æµ‹è¯•è¶…æ—¶!");
        $display("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        $finish(2);  // è¿”å› 2 è¡¨ç¤ºè¶…æ—¶
    end

endmodule

`default_nettype wire
